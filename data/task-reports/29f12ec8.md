# Task 29f12ec8: [Fix] NO_MESSAGE refinement for natural conversation

- Status: completed
- Agent: fcd98bac
- Session: 1e5dd7fc

## Description
Refine NO_MESSAGE feature: should allow agent to skip responses for natural conversation moments (e.g., user says 'okay', 'alright', etc.) rather than always responding with a question or filler. Make it feel more natural, less forced.

## Result Summary
Here's what changed:

**1. Rewritten prompt guidance** (`stream-agent-chat.ts` + `manager.ts`)
- Replaced the mechanical rule list with a "thoughtful friend" framing
- Added specific casual phrases the LLM should recognize as conversation closers: "alright", "cool", "sounds good", "haha", "lol", "night", "ttyl", "gotta go"
- The decision test is now intuitive: "would a friend feel compelled to type something back?"
- Preserved the hard rules (always reply to questions, tasks, emotional sharing)

**2. Fixed connector NO_MESSAGE detection** (all 4 connectors)
- Discord, Telegram, Slack, WhatsApp now use `isNoMessage()` instead of raw `=== 'NO_MESSAGE'`
- Handles whitespace and case variations the LLM might produce

**3. Stopped polluting session history**
- Previously saved the literal string "NO_MESSAGE" as an assistant message â€” the LLM would see this in subsequent context, which is confusing and could bias its behavior
- Now the NO_MESSAGE check happens *before* the history save, so suppressed replies leave no trace in the conversation

## Changed Files
- **1. Rewritten prompt guidance** (`stream-agent-chat.ts` + `manager.ts`)

## Commands Run
- Not provided

## Verification
- The decision test is now intuitive: "would a friend feel compelled to type something back?"
