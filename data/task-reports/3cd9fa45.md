# Task 3cd9fa45: Add NO_MESSAGE option to agent responses

- Status: completed
- Agent: fcd98bac
- Session: 5664500e

## Description
Update all system prompts to tell agents they don't always need to respond with a question. Add NO_MESSAGE or blank message option that triggers no outbound send. Makes conversations feel more natural — agents can acknowledge receipt without forcing a reply. Prevents every interaction from feeling like it demands a user response. Include guidance on when to use NO_MESSAGE vs when to actually reply.

## Result Summary
Here's what was done across 6 files:

**System prompt changes:**

- **`stream-agent-chat.ts`** — Added a `## NO_MESSAGE Response Option` section to `buildAgenticExecutionPolicy()`. This reaches all agents using the tool-based agentic loop. Includes clear guidance on when to use it (acks, "ok", "thanks", conversation-ending messages) and when not to (questions, tasks, emotional content).

- **`connectors/manager.ts`** — Added the same NO_MESSAGE guidance to the connector-specific system prompt appended to every connector-routed message. This ensures even non-agentic (direct provider) connector paths get the instruction.

**Response handling:**

- **`connectors/manager.ts`** — Added `NO_MESSAGE_SENTINEL` constant and `isNoMessage()` helper. In `routeMessage()`, the agent's response is still saved to session history (preserves context), but when it's NO_MESSAGE, the sentinel is returned so connectors can suppress the outbound send.

**Connector suppression (4 files):**

- **`discord.ts`** — Early return before `message.channel.send()` when response is `NO_MESSAGE`
- **`telegram.ts`** — Early return before `ctx.reply()` when response is `NO_MESSAGE`
- **`whatsapp.ts`** — Conditional guard around `instance.sendMessage()` when response is `NO_MESSAGE`
- **`slack.ts`** — Early return in both the direct message handler and the `app_mention` handler

The build type-checks cleanly. Agents will now naturally choose silence when a reply would feel forced, making connector conversations feel more human.

## Changed Files
- **`stream-agent-chat.ts`** — Added a `## NO_MESSAGE Response Option` section to `buildAgenticExecutionPolicy()`. This reaches all agents using the tool-based agentic loop. Includes clear guidance on when to use it (acks, "ok", "thanks", conversation-ending messages) and when not to (questions, tasks, emotional content).
- **`connectors/manager.ts`** — Added the same NO_MESSAGE guidance to the connector-specific system prompt appended to every connector-routed message. This ensures even non-agentic (direct provider) connector paths get the instruction.
- **`connectors/manager.ts`** — Added `NO_MESSAGE_SENTINEL` constant and `isNoMessage()` helper. In `routeMessage()`, the agent's response is still saved to session history (preserves context), but when it's NO_MESSAGE, the sentinel is returned so connectors can suppress the outbound send.
- **`discord.ts`** — Early return before `message.channel.send()` when response is `NO_MESSAGE`
- **`telegram.ts`** — Early return before `ctx.reply()` when response is `NO_MESSAGE`
- **`whatsapp.ts`** — Conditional guard around `instance.sendMessage()` when response is `NO_MESSAGE`
- **`slack.ts`** — Early return in both the direct message handler and the `app_mention` handler

## Commands Run
- Not provided

## Verification
- The build type-checks cleanly. Agents will now naturally choose silence when a reply would feel forced, making connector conversations feel more human.
