# Task a7f884ed: CLI tool file passing - verify task attachments reach CLI tools

- Status: completed
- Agent: fcd98bac
- Session: 225253a1

## Description
Validate that images/files attached to tasks actually get passed to CLI tools (Codex, Claude Code, OpenCode) during delegation. Test the full flow: attach image to task → delegate to Codex → verify Codex receives the image.

## Result Summary
## Findings: Task Image Attachments Are **Not** Passed to CLI Tools

I traced the full flow. Images attached to tasks are a **dead end** — they're stored and displayed in the UI but completely dropped when a task is executed.

### The Chain of Breaks

| Step | Location | What Happens |
|-|-|-|
| **1. Storage** | `src/types/index.ts:393` | `BoardTask.images?: string[]` — images stored as URL strings |
| **2. UI** | `task-sheet.tsx` | Upload works, images saved on task via PUT |
| **3. Queue pickup** | `src/lib/server/queue.ts:84` | `executeOrchestrator(agent, task.description \|\| task.title, sessionId)` — **only passes text**, `task.images` is never referenced |
| **4. Orchestrator** | `src/lib/server/orchestrator.ts:60` | `executeOrchestrator(orchestrator, task: string, sessionId)` — signature accepts a plain string, no image parameter |
| **5. CLI delegation** | `session-tools.ts:862-863` | All three delegation tool schemas (`delegate_to_claude_code`, `delegate_to_codex_cli`, `delegate_to_opencode_cli`) only accept `{ task: string, resume?, resumeId? }` — **no image/attachment parameter** |

### Specific Gaps

1. **`queue.ts:84`** — The first break. Has access to the full `task` object (including `task.images`) but only extracts `task.description || task.title`.

2. **`orchestrator.ts:60`** — `executeOrchestrator` signature is `(agent, task: string, sessionId)`. No way to pass images even if the queue tried.

3. **All three CLI delegation tools** — Their Zod schemas don't include an images/files field. Even if images reached the orchestrator, the tools can't forward them to Codex/Claude Code/OpenCode.

4. **CLI tools themselves** — Claude Code supports `--image` flags, Codex supports `--images`, but the spawn logic in `session-tools.ts` doesn't construct these flags.

### What Would Need to Change

To fix this end-to-end:

1. **`queue.ts`** — Pass `task.images` alongside the description to the orchestrator
2. **`orchestrator.ts`** — Change `executeOrchestrator` si

## Changed Files
- | **1. Storage** | `src/types/index.ts:393` | `BoardTask.images?: string[]` — images stored as URL strings |
- | **2. UI** | `task-sheet.tsx` | Upload works, images saved on task via PUT |
- | **3. Queue pickup** | `src/lib/server/queue.ts:84` | `executeOrchestrator(agent, task.description \|\| task.title, sessionId)` — **only passes text**, `task.images` is never referenced |
- | **4. Orchestrator** | `src/lib/server/orchestrator.ts:60` | `executeOrchestrator(orchestrator, task: string, sessionId)` — signature accepts a plain string, no image parameter |
- | **5. CLI delegation** | `session-tools.ts:862-863` | All three delegation tool schemas (`delegate_to_claude_code`, `delegate_to_codex_cli`, `delegate_to_opencode_cli`) only accept `{ task: string, resume?, resumeId? }` — **no image/attachment parameter** |
- 1. **`queue.ts:84`** — The first break. Has access to the full `task` object (including `task.images`) but only extracts `task.description || task.title`.
- 2. **`orchestrator.ts:60`** — `executeOrchestrator` signature is `(agent, task: string, sessionId)`. No way to pass images even if the queue tried.
- 4. **CLI tools themselves** — Claude Code supports `--image` flags, Codex supports `--images`, but the spawn logic in `session-tools.ts` doesn't construct these flags.

## Commands Run
- Not provided

## Verification
- ## Findings: Task Image Attachments Are **Not** Passed to CLI Tools
